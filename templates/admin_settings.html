{% extends "base.html" %}

{% block title %}Admin Settings - Job Application System{% endblock %}

{% block head_extra %}
<style>
    .settings-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .settings-header {
        background: linear-gradient(135deg, #2c3e50, #3498db);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
        text-align: center;
    }
    
    .settings-header h1 {
        margin: 0;
        font-size: 2.5rem;
        font-weight: 300;
    }
    
    .settings-header p {
        margin: 10px 0 0 0;
        opacity: 0.9;
        font-size: 1.1rem;
    }
    
    .settings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
    }
    
    .settings-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid #e9ecef;
    }
    
    .settings-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .settings-card h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .settings-card .icon {
        font-size: 1.5rem;
    }
    
    .settings-form {
        margin-top: 15px;
    }
    
    .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
    }
    
    .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
    }
    
    .form-group label {
        color: #495057;
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .form-control {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: #f8f9fa;
    }
    
    .form-control:focus {
        border-color: #3498db;
        background: white;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }
    
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }
    
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 34px;
    }
    
    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    input:checked + .slider {
        background-color: #3498db;
    }
    
    input:checked + .slider:before {
        transform: translateX(26px);
    }
    
    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .setting-item:last-child {
        border-bottom: none;
    }
    
    .setting-info {
        flex: 1;
    }
    
    .setting-info h4 {
        margin: 0 0 5px 0;
        color: #2c3e50;
        font-size: 1rem;
    }
    
    .setting-info p {
        margin: 0;
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .btn-settings {
        background: linear-gradient(45deg, #3498db, #2980b9);
        border: none;
        color: white;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .btn-settings:hover {
        background: linear-gradient(45deg, #2980b9, #1f618d);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }
    
    .btn-danger-settings {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
    }
    
    .btn-danger-settings:hover {
        background: linear-gradient(45deg, #c0392b, #a93226);
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .stat-item {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid #dee2e6;
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #3498db;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .backup-status {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
    }
    
    .system-info {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border: 1px solid #dee2e6;
    }
    
    .system-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
    }
    
    .system-info-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #dee2e6;
    }
    
    .system-info-item:last-child {
        border-bottom: none;
    }
    
    .email-test {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
    }
    
    @media (max-width: 768px) {
        .settings-grid {
            grid-template-columns: 1fr;
        }
        
        .form-row {
            flex-direction: column;
        }
        
        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
        
        .settings-header h1 {
            font-size: 2rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="settings-header">
        <h1>‚öôÔ∏è System Settings</h1>
        <p>Configure and manage your job application system</p>
    </div>

    <div class="settings-grid">
        <!-- Application Settings -->
        <div class="settings-card">
            <h3><span class="icon">üìã</span>Application Settings</h3>
            <form class="settings-form" method="POST" action="/admin/settings/application">
                <div class="form-group">
                    <label for="max_applications">Max Applications per Job</label>
                    <input type="number" id="max_applications" name="max_applications" class="form-control" value="100" min="1">
                </div>
                
                <div class="form-group">
                    <label for="application_deadline">Default Application Deadline (days)</label>
                    <input type="number" id="application_deadline" name="application_deadline" class="form-control" value="30" min="1">
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Auto-reject after deadline</h4>
                        <p>Automatically reject applications after deadline</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="auto_reject" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <button type="submit" class="btn-settings">Save Application Settings</button>
            </form>
        </div>

        <!-- Assessment Settings -->
        <div class="settings-card">
            <h3><span class="icon">üéØ</span>Assessment Settings</h3>
            <form class="settings-form" method="POST" action="/admin/settings/assessment">
                <div class="form-group">
                    <label for="default_timer">Default Assessment Timer (minutes)</label>
                    <input type="number" id="default_timer" name="default_timer" class="form-control" value="60" min="5">
                </div>
                
                <div class="form-group">
                    <label for="min_pass_score">Minimum Passing Score (%)</label>
                    <input type="number" id="min_pass_score" name="min_pass_score" class="form-control" value="70" min="0" max="100">
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Auto-generate questions</h4>
                        <p>Use AI to generate assessment questions</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="auto_generate" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <button type="submit" class="btn-settings">Save Assessment Settings</button>
            </form>
        </div>

        <!-- Email Settings -->
        <div class="settings-card">
            <h3><span class="icon">üìß</span>Email Configuration</h3>
            <form class="settings-form" method="POST" action="/admin/settings/email">
                <div class="form-group">
                    <label for="smtp_server">SMTP Server</label>
                    <input type="text" id="smtp_server" name="smtp_server" class="form-control" value="smtp.gmail.com" placeholder="smtp.gmail.com">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="smtp_port">SMTP Port</label>
                        <input type="number" id="smtp_port" name="smtp_port" class="form-control" value="587">
                    </div>
                    <div class="form-group">
                        <label for="smtp_username">Username</label>
                        <input type="email" id="smtp_username" name="smtp_username" class="form-control" placeholder="your-email@gmail.com">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="smtp_password">Password</label>
                    <input type="password" id="smtp_password" name="smtp_password" class="form-control" placeholder="Enter SMTP password">
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Enable Email Notifications</h4>
                        <p>Send automated emails to candidates</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="email_enabled" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <button type="submit" class="btn-settings">Save Email Settings</button>
                
                <div class="email-test">
                    <strong>Test Email Configuration:</strong>
                    <button type="button" class="btn btn-secondary" onclick="testEmail()" style="margin-left: 10px;">Send Test Email</button>
                </div>
            </form>
        </div>

        <!-- Interview Settings -->
        <div class="settings-card">
            <h3><span class="icon">ü§ù</span>Interview Settings</h3>
            <form class="settings-form" method="POST" action="/admin/settings/interview">
                <div class="form-group">
                    <label for="interview_duration">Default Interview Duration (minutes)</label>
                    <input type="number" id="interview_duration" name="interview_duration" class="form-control" value="60" min="15">
                </div>
                
                <div class="form-group">
                    <label for="reminder_time">Reminder Time (hours before)</label>
                    <input type="number" id="reminder_time" name="reminder_time" class="form-control" value="24" min="1">
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Auto-schedule interviews</h4>
                        <p>Automatically schedule based on availability</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="auto_schedule">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Send interview reminders</h4>
                        <p>Send email reminders before interviews</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="send_reminders" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <button type="submit" class="btn-settings">Save Interview Settings</button>
            </form>
        </div>

        <!-- Security Settings -->
        <div class="settings-card">
            <h3><span class="icon">üîê</span>Security Settings</h3>
            <form class="settings-form" method="POST" action="/admin/settings/security">
                <div class="form-group">
                    <label for="session_timeout">Session Timeout (minutes)</label>
                    <input type="number" id="session_timeout" name="session_timeout" class="form-control" value="120" min="15">
                </div>
                
                <div class="form-group">
                    <label for="max_file_size">Max File Size (MB)</label>
                    <input type="number" id="max_file_size" name="max_file_size" class="form-control" value="16" min="1" max="100">
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Enable Two-Factor Authentication</h4>
                        <p>Require 2FA for admin accounts</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="enable_2fa">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Log Admin Actions</h4>
                        <p>Track all administrative activities</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="log_actions" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <button type="submit" class="btn-settings">Save Security Settings</button>
            </form>
        </div>

        <!-- System Maintenance -->
        <div class="settings-card">
            <h3><span class="icon">üõ†Ô∏è</span>System Maintenance</h3>
            
            <div class="backup-status">
                <strong>Last Database Backup:</strong> Today at 3:00 AM<br>
                <strong>Status:</strong> ‚úÖ Successful
            </div>
            
            <div class="setting-item">
                <div class="setting-info">
                    <h4>Auto Database Backup</h4>
                    <p>Automatically backup database daily</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="auto_backup" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div style="margin: 20px 0;">
                <button type="button" class="btn-settings" onclick="backupDatabase()">
                    Create Backup Now
                </button>
                <button type="button" class="btn btn-secondary" onclick="clearLogs()" style="margin-left: 10px;">
                    Clear System Logs
                </button>
            </div>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                <h4 style="color: #dc3545; margin-bottom: 10px;">‚ö†Ô∏è Danger Zone</h4>
                <button type="button" class="btn-danger-settings" onclick="confirmReset()">
                    Reset All Settings
                </button>
            </div>
        </div>
    </div>

    <!-- System Information -->
    <div class="settings-card">
        <h3><span class="icon">üìä</span>System Information</h3>
        
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">{{ stats.total_applications if stats else '150' }}</div>
                <div class="stat-label">Total Applications</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ stats.total_jobs if stats else '12' }}</div>
                <div class="stat-label">Active Jobs</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ stats.total_interviewers if stats else '8' }}</div>
                <div class="stat-label">Interviewers</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ stats.scheduled_interviews if stats else '25' }}</div>
                <div class="stat-label">Scheduled Interviews</div>
            </div>
        </div>
        
        <div class="system-info">
            <div class="system-info-grid">
                <div class="system-info-item">
                    <strong>System Version:</strong>
                    <span>v2.1.0</span>
                </div>
                <div class="system-info-item">
                    <strong>Database:</strong>
                    <span>MySQL 8.0</span>
                </div>
                <div class="system-info-item">
                    <strong>Server Uptime:</strong>
                    <span>15 days, 4 hours</span>
                </div>
                <div class="system-info-item">
                    <strong>Last Updated:</strong>
                    <span>2025-06-10</span>
                </div>
                <div class="system-info-item">
                    <strong>Storage Used:</strong>
                    <span>2.4 GB / 10 GB</span>
                </div>
                <div class="system-info-item">
                    <strong>Active Sessions:</strong>
                    <span>7</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function testEmail() {
        const button = event.target;
        button.textContent = 'Sending...';
        button.disabled = true;
        
        // Simulate email test
        setTimeout(() => {
            button.textContent = 'Test Sent ‚úì';
            button.style.backgroundColor = '#28a745';
            
            setTimeout(() => {
                button.textContent = 'Send Test Email';
                button.disabled = false;
                button.style.backgroundColor = '';
            }, 3000);
        }, 2000);
    }
    
    function backupDatabase() {
        if (confirm('Create a database backup now? This may take a few minutes.')) {
            const button = event.target;
            button.textContent = 'Creating Backup...';
            button.disabled = true;
            
            // Simulate backup process
            setTimeout(() => {
                button.textContent = 'Backup Created ‚úì';
                button.style.backgroundColor = '#28a745';
                
                setTimeout(() => {
                    button.textContent = 'Create Backup Now';
                    button.disabled = false;
                    button.style.backgroundColor = '';
                }, 3000);
            }, 3000);
        }
    }
    
    function clearLogs() {
        if (confirm('Are you sure you want to clear all system logs? This action cannot be undone.')) {
            const button = event.target;
            button.textContent = 'Clearing...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = 'Logs Cleared ‚úì';
                button.style.backgroundColor = '#28a745';
                
                setTimeout(() => {
                    button.textContent = 'Clear System Logs';
                    button.disabled = false;
                    button.style.backgroundColor = '';
                }, 3000);
            }, 1500);
        }
    }
    
    function confirmReset() {
        if (confirm('‚ö†Ô∏è WARNING: This will reset ALL settings to default values. This action cannot be undone.\n\nAre you absolutely sure you want to continue?')) {
            if (confirm('This is your final warning. All custom settings will be lost. Continue?')) {
                alert('Settings reset functionality would be implemented here.');
            }
        }
    }
    
    // Auto-save indication
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const button = this.querySelector('button[type="submit"]');
            const originalText = button.textContent;
            
            button.textContent = 'Saving...';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = 'Saved ‚úì';
                button.style.backgroundColor = '#28a745';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                    button.style.backgroundColor = '';
                }, 2000);
            }, 1000);
        });
    });
    
    // Toggle switch animation
    document.querySelectorAll('.toggle-switch input').forEach(toggle => {
        toggle.addEventListener('change', function() {
            const setting = this.closest('.setting-item');
            if (setting) {
                setting.style.opacity = '0.7';
                setTimeout(() => {
                    setting.style.opacity = '1';
                }, 300);
            }
        });
    });
</script>
{% endblock %}