{% extends "base.html" %}

{% block title %}Manage Interview Slots - Job Application System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Manage Interview Slots</h1>
    <a href="{{ url_for('interviewer_dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
</div>

<div class="card">
    <h3>Add New Interview Slot</h3>
    <form method="POST">
        <div class="form-group">
            <label for="slot_datetime">Date and Time:</label>
            <input type="datetime-local" id="slot_datetime" name="slot_datetime" required>
        </div>
        
        <div class="form-group">
            <label for="mode">Interview Mode:</label>
            <select id="mode" name="mode" required onchange="toggleModeFields()">
                <option value="">Select Mode</option>
                <option value="Online">Online</option>
                <option value="Offline">Offline</option>
            </select>
        </div>
        
        <div class="form-group" id="meeting_link_group" style="display: none;">
            <label for="meeting_link">Meeting Link:</label>
            <input type="url" id="meeting_link" name="meeting_link" placeholder="https://meet.google.com/xxx-xxxx-xxx">
        </div>
        
        <div class="form-group" id="address_group" style="display: none;">
            <label for="address">Address:</label>
            <textarea id="address" name="address" placeholder="Enter the physical address for the interview"></textarea>
        </div>
        
        <button type="submit" class="btn btn-success">Add Slot</button>
    </form>
</div>

<div class="card">
    <h3>Your Interview Slots</h3>
    {% if slots %}
        <table>
            <thead>
                <tr>
                    <th>Date & Time</th>
                    <th>Mode</th>
                    <th>Status</th>
                    <th>Details</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for slot in slots %}
                <tr>
                    <td>{{ slot.slot_datetime.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>{{ slot.mode }}</td>
                    <td>
                        {% if slot.is_booked %}
                            <span style="color: #dc3545; font-weight: bold;">Booked</span>
                        {% elif slot.slot_datetime <= moment.now() %}
                            <span style="color: #6c757d;">Expired</span>
                        {% else %}
                            <span style="color: #28a745; font-weight: bold;">Available</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if slot.mode == 'Online' %}
                            <strong>Meeting Link:</strong> 
                            {% if slot.meeting_link %}
                                <a href="{{ slot.meeting_link }}" target="_blank">{{ slot.meeting_link }}</a>
                            {% else %}
                                Not provided
                            {% endif %}
                        {% else %}
                            <strong>Address:</strong> {{ slot.address or 'Not provided' }}
                        {% endif %}
                    </td>
                    <td>
                        {% if not slot.is_booked %}
                            <form method="POST" action="{{ url_for('delete_slot', slot_id=slot.id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this slot?')">Delete</button>
                            </form>
                        {% else %}
                            <span style="color: #6c757d;">Cannot delete (booked)</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>You haven't created any interview slots yet.</p>
    {% endif %}
</div>

<script>
function toggleModeFields() {
    const mode = document.getElementById('mode').value;
    const meetingLinkGroup = document.getElementById('meeting_link_group');
    const addressGroup = document.getElementById('address_group');
    
    if (mode === 'Online') {
        meetingLinkGroup.style.display = 'block';
        addressGroup.style.display = 'none';
        document.getElementById('meeting_link').required = true;
        document.getElementById('address').required = false;
    } else if (mode === 'Offline') {
        meetingLinkGroup.style.display = 'none';
        addressGroup.style.display = 'block';
        document.getElementById('meeting_link').required = false;
        document.getElementById('address').required = true;
    } else {
        meetingLinkGroup.style.display = 'none';
        addressGroup.style.display = 'none';
        document.getElementById('meeting_link').required = false;
        document.getElementById('address').required = false;
    }
}

// Set minimum date to current date
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    
    const minDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
    document.getElementById('slot_datetime').min = minDateTime;
});
</script>
{% endblock %}