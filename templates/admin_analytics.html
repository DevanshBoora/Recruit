{% extends "base.html" %}

{% block title %}Analytics Dashboard - DEVORKS{% endblock %}

{% block head_extra %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
    .stats-overview {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .stat-label {
        font-size: 1rem;
        opacity: 0.9;
    }
    
    .charts-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
    }
    
    .chart-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        border: 1px solid #e0e0e0;
    }
    
    .chart-title {
        font-size: 1.4rem;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 20px;
        text-align: center;
    }
    
    .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 15px;
    }
    
    .insights-section {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        border: 1px solid #e0e0e0;
    }
    
    .insights-title {
        font-size: 1.4rem;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 20px;
    }
    
    .insight-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #007bff;
    }
    
    .insight-label {
        font-weight: 500;
        color: #495057;
    }
    
    .insight-value {
        font-weight: bold;
        color: #2c3e50;
        font-size: 1.1rem;
    }
    
    .no-data {
        text-align: center;
        color: #6c757d;
        font-style: italic;
        padding: 40px;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Analytics Dashboard</h1>
    <a href="/admin/dashboard" class="btn btn-secondary">‚Üê Back to Dashboard</a>
</div>

<!-- Statistics Overview -->
<div class="stats-overview">
    <div class="stat-card">
        <div class="stat-number">{{ status_stats|length if status_stats else 0 }}</div>
        <div class="stat-label">Application Categories</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ job_type_stats|length if job_type_stats else 0 }}</div>
        <div class="stat-label">Job Types</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ monthly_stats|length if monthly_stats else 0 }}</div>
        <div class="stat-label">Active Months</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">
            {% if avg_scores and avg_scores.avg_eligibility %}
                {{ "%.1f"|format(avg_scores.avg_eligibility) }}
            {% else %}
                0.0
            {% endif %}
        </div>
        <div class="stat-label">Avg Eligibility Score</div>
    </div>
</div>

<!-- Charts Section -->
<div class="charts-container">
    <!-- Application Status Chart -->
    <div class="chart-card">
        <h3 class="chart-title">Applications by Status</h3>
        {% if status_stats %}
            <div class="chart-container">
                <canvas id="statusChart"></canvas>
            </div>
        {% else %}
            <div class="no-data">No application data available</div>
        {% endif %}
    </div>

    <!-- Job Type Chart -->
    <div class="chart-card">
        <h3 class="chart-title">Applications by Job Type</h3>
        {% if job_type_stats %}
            <div class="chart-container">
                <canvas id="jobTypeChart"></canvas>
            </div>
        {% else %}
            <div class="no-data">No job type data available</div>
        {% endif %}
    </div>

    <!-- Monthly Trends Chart -->
    <div class="chart-card">
        <h3 class="chart-title">Monthly Application Trends</h3>
        {% if monthly_stats %}
            <div class="chart-container">
                <canvas id="monthlyChart"></canvas>
            </div>
        {% else %}
            <div class="no-data">No monthly trend data available</div>
        {% endif %}
    </div>

    <!-- Average Scores Chart -->
    <div class="chart-card">
        <h3 class="chart-title">Average Performance Scores</h3>
        {% if avg_scores %}
            <div class="chart-container">
                <canvas id="scoresChart"></canvas>
            </div>
        {% else %}
            <div class="no-data">No score data available</div>
        {% endif %}
    </div>
</div>

<!-- Key Insights Section -->
<div class="insights-section">
    <h3 class="insights-title">Key Insights</h3>
    
    {% if avg_scores %}
        <div class="insight-item">
            <span class="insight-label">Average Eligibility Score</span>
            <span class="insight-value">
                {{ "%.2f"|format(avg_scores.avg_eligibility) if avg_scores.avg_eligibility else "N/A" }}
            </span>
        </div>
        
        <div class="insight-item">
            <span class="insight-label">Average Assessment Score</span>
            <span class="insight-value">
                {{ "%.2f"|format(avg_scores.avg_assessment) if avg_scores.avg_assessment else "N/A" }}
            </span>
        </div>
        
        <div class="insight-item">
            <span class="insight-label">Average Communication Score</span>
            <span class="insight-value">
                {{ "%.2f"|format(avg_scores.avg_communication) if avg_scores.avg_communication else "N/A" }}
            </span>
        </div>
        
        <div class="insight-item">
            <span class="insight-label">Average Technical Score</span>
            <span class="insight-value">
                {{ "%.2f"|format(avg_scores.avg_technical) if avg_scores.avg_technical else "N/A" }}
            </span>
        </div>
        
        <div class="insight-item">
            <span class="insight-label">Average Problem Solving Score</span>
            <span class="insight-value">
                {{ "%.2f"|format(avg_scores.avg_problem_solving) if avg_scores.avg_problem_solving else "N/A" }}
            </span>
        </div>
    {% else %}
        <div class="no-data">No performance data available for insights</div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
// Chart.js default configuration
Chart.defaults.responsive = true;
Chart.defaults.maintainAspectRatio = false;

// Status Distribution Chart
{% if status_stats %}
const statusData = {
    labels: [{% for status, count in status_stats %}'{{ status }}'{% if not loop.last %},{% endif %}{% endfor %}],
    datasets: [{
        data: [{% for status, count in status_stats %}{{ count }}{% if not loop.last %},{% endif %}{% endfor %}],
        backgroundColor: [
            '#28a745', // Green for Accepted
            '#dc3545', // Red for Rejected  
            '#ffc107', // Yellow for Pending
            '#17a2b8', // Blue for other statuses
            '#6f42c1'  // Purple for additional statuses
        ],
        borderWidth: 2,
        borderColor: '#fff'
    }]
};

new Chart(document.getElementById('statusChart'), {
    type: 'doughnut',
    data: statusData,
    options: {
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 20,
                    usePointStyle: true
                }
            }
        }
    }
});
{% endif %}

// Job Type Chart
{% if job_type_stats %}
const jobTypeData = {
    labels: [{% for job_type, count in job_type_stats %}'{{ job_type }}'{% if not loop.last %},{% endif %}{% endfor %}],
    datasets: [{
        label: 'Applications',
        data: [{% for job_type, count in job_type_stats %}{{ count }}{% if not loop.last %},{% endif %}{% endfor %}],
        backgroundColor: [
            '#007bff', '#28a745', '#ffc107', '#dc3545', '#17a2b8', 
            '#6f42c1', '#fd7e14', '#20c997', '#e83e8c', '#6c757d'
        ],
        borderWidth: 1
    }]
};

new Chart(document.getElementById('jobTypeChart'), {
    type: 'bar',
    data: jobTypeData,
    options: {
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
{% endif %}

// Monthly Trends Chart
{% if monthly_stats %}
const monthlyData = {
    labels: [{% for month, count in monthly_stats %}'{{ month }}'{% if not loop.last %},{% endif %}{% endfor %}],
    datasets: [{
        label: 'Applications',
        data: [{% for month, count in monthly_stats %}{{ count }}{% if not loop.last %},{% endif %}{% endfor %}],
        borderColor: '#007bff',
        backgroundColor: 'rgba(0, 123, 255, 0.1)',
        fill: true,
        tension: 0.4,
        pointBackgroundColor: '#007bff',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        pointRadius: 5
    }]
};

new Chart(document.getElementById('monthlyChart'), {
    type: 'line',
    data: monthlyData,
    options: {
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
{% endif %}

// Average Scores Chart
{% if avg_scores %}
const scoresData = {
    labels: ['Eligibility', 'Assessment', 'Communication', 'Technical', 'Problem Solving'],
    datasets: [{
        label: 'Average Score',
        data: [
            {{ avg_scores.avg_eligibility|round(2) if avg_scores.avg_eligibility else 0 }},
            {{ avg_scores.avg_assessment|round(2) if avg_scores.avg_assessment else 0 }},
            {{ avg_scores.avg_communication|round(2) if avg_scores.avg_communication else 0 }},
            {{ avg_scores.avg_technical|round(2) if avg_scores.avg_technical else 0 }},
            {{ avg_scores.avg_problem_solving|round(2) if avg_scores.avg_problem_solving else 0 }}
        ],
        backgroundColor: [
            'rgba(40, 167, 69, 0.8)',
            'rgba(0, 123, 255, 0.8)', 
            'rgba(255, 193, 7, 0.8)',
            'rgba(220, 53, 69, 0.8)',
            'rgba(111, 66, 193, 0.8)'
        ],
        borderColor: [
            '#28a745', '#007bff', '#ffc107', '#dc3545', '#6f42c1'
        ],
        borderWidth: 2
    }]
};

new Chart(document.getElementById('scoresChart'), {
    type: 'radar',
    data: scoresData,
    options: {
        scales: {
            r: {
                beginAtZero: true,
                max: 100,
                ticks: {
                    stepSize: 20
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
{% endif %}
</script>
{% endblock %}
